<div class="offcanvas-header" >
  <h2 class="offcanvas-title m-0" id="offcanvasDarkLabel">User Score</h2>
  <button type="button" class="btn-close" (click)="offcanvasService.dismiss()"></button>
</div>
<div class="offcanvas-body" style="max-height: 90vh; overflow-y: scroll;">
  <div class="card">
    <div class="card-body">
      <img class="card-img mb-3 music-img sm"
           src="{{host}}assets/ongeki/jacket/UI_Jacket_{{music.id|formatNumber:4}}.jpg"
           alt="">
      <div class="position-relative">
        <h5 class="card-title mb-1 fw-bold">「{{music.name}}」</h5>
        <span class="card-subtitle music-artistName" style="font-size: 12px">{{music.artistName}}</span>
        <hr>
      </div>
      <section>
        <ng-template #difficultyDetail let-difficulty>
          <div class="card my-2">
              <ng-container [ngSwitch]="difficulty">
                <div *ngSwitchCase="0" class="card-header py-0 px-2 bg-basic text-truncate fw-bold">
                  Basic
                  {{getLevelString(music, difficulty) | toLevelDecimal}}
                </div>
                <div *ngSwitchCase="1" class="card-header py-0 px-2 bg-advanced text-truncate fw-bold">
                  Advanced
                  {{getLevelString(music, difficulty) | toLevelDecimal}}
                </div>
                <div *ngSwitchCase="2" class="card-header py-0 px-2 bg-expert text-truncate fw-bold">
                  Expert
                  {{getLevelString(music, difficulty) | toLevelDecimal}}
                </div>
                <div *ngSwitchCase="3" class="card-header py-0 px-2 bg-master text-truncate fw-bold">
                  Master
                  {{getLevelString(music, difficulty) | toLevelDecimal}}
                </div>
                <div *ngSwitchCase="4"
                     class="card-header py-0 px-2 bg-lunatic text-danger border-danger text-truncate fw-bold">
                  Lunatic
                  {{getLevelString(music, difficulty) | toLevelDecimal}}
                </div>
              </ng-container>
            <div class="card-body p-0 px-2">
              <div class="d-flex align-items-center justify-content-between">
                <div class="score float-start">
                  <span *ngIf="songData[difficulty]" class="score-font-large">{{songData[difficulty].techScoreMax}}</span>
                  <span *ngIf="!songData[difficulty]" class="score-font-large">No Record</span>
                </div>
                <div *ngIf="songData[difficulty]" class="honor float-end">
                  <img class="honor-badge"
                       src="{{host}}assets/ongeki/gameUi/{{songData[difficulty].techScoreRank|toTechHonorSprite}}" alt="">
                  <ng-container *ngIf="songData[difficulty].isAllBreake">
                    <img class="honor-badge"
                         src="{{host}}assets/ongeki/gameUi/UI_SLC_MusicSelect_HornorBadge_AB.png" alt="">
                  </ng-container>
                  <ng-container *ngIf="!songData[difficulty].isAllBreake && songData[difficulty].isFullCombo">
                    <img class="honor-badge"
                         src="{{host}}assets/ongeki/gameUi/UI_SLC_MusicSelect_HornorBadge_FC.png" alt="">
                  </ng-container>
                  <ng-container *ngIf="!songData[difficulty].isAllBreake && !songData[difficulty].isFullCombo">
                    <img class="honor-badge"
                         src="{{host}}assets/ongeki/gameUi/UI_SLC_MusicSelect_HornorBadge_None.png" alt="">
                  </ng-container>
                  <img class="honor-badge"
                       src="{{host}}assets/ongeki/gameUi/UI_SLC_MusicSelect_HornorBadge_{{songData[difficulty].isFullBell?'FB':'None'}}.png"
                       alt="">
                </div>
              </div>
            </div>
          </div>
        </ng-template>
        <ng-container *ngIf="parseFloat(music.level3) != 0 && songData">
          <ng-container *ngTemplateOutlet="difficultyDetail; context: {$implicit: 0}"></ng-container>
          <ng-container *ngTemplateOutlet="difficultyDetail; context: {$implicit: 1}"></ng-container>
          <ng-container *ngTemplateOutlet="difficultyDetail; context: {$implicit: 2}"></ng-container>
          <ng-container *ngTemplateOutlet="difficultyDetail; context: {$implicit: 3}"></ng-container>
        </ng-container>
        <ng-container *ngIf="parseFloat(music.level3) == 0 && songData">
          <ng-container *ngTemplateOutlet="difficultyDetail; context: {$implicit: 4}"></ng-container>
        </ng-container>
      </section>

      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <button class="nav-link" id="nav-ba-tab" (click)="handleTabButtonClick(0)" data-bs-toggle="tab" data-bs-target="#nav-ba" type="button" role="tab" aria-controls="nav-ba" aria-selected="false">BA</button>
          <button class="nav-link" id="nav-ad-tab" (click)="handleTabButtonClick(1)" data-bs-toggle="tab" data-bs-target="#nav-ad" type="button" role="tab" aria-controls="nav-ad" aria-selected="false">AD</button>
          <button class="nav-link" id="nav-ex-tab" (click)="handleTabButtonClick(2)" data-bs-toggle="tab" data-bs-target="#nav-ex" type="button" role="tab" aria-controls="nav-ex" aria-selected="false">EX</button>
          <button class="nav-link active" id="nav-ma-tab" (click)="handleTabButtonClick(3)" data-bs-toggle="tab" data-bs-target="#nav-ma" type="button" role="tab" aria-controls="nav-ma" aria-selected="true">MA</button>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade" id="nav-ba" role="tabpanel" aria-labelledby="nav-ba-tab" tabindex="0">
          <table class="table table-striped table-borderless">
            <thead>
            <th>No.</th>
            <th>Username</th>
            <th>Score</th>
            </thead>
            <tbody>
            <tr *ngFor="let item of ranking; index as i">
              <td>{{ i + 1 }}</td>
              <td>{{ item.username }}</td>
              <td>{{ item.score }}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="tab-pane fade" id="nav-ad" role="tabpanel" aria-labelledby="nav-ad-tab" tabindex="0">
          <table class="table table-striped table-borderless">
            <thead>
            <th>No.</th>
            <th>Username</th>
            <th>Score</th>
            </thead>
            <tbody>
            <tr *ngFor="let item of ranking; index as i">
              <td>{{ i + 1 }}</td>
              <td>{{ item.username }}</td>
              <td>{{ item.score }}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="tab-pane fade" id="nav-ex" role="tabpanel" aria-labelledby="nav-ex-tab" tabindex="0">
          <table class="table table-striped table-borderless">
            <thead>
            <th>No.</th>
            <th>Username</th>
            <th>Score</th>
            </thead>
            <tbody>
            <tr *ngFor="let item of ranking; index as i">
              <td>{{ i + 1 }}</td>
              <td>{{ item.username }}</td>
              <td>{{ item.score }}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="tab-pane fade show active" id="nav-ma" aria-labelledby="nav-ma-tab" tabindex="0">
          <table class="table table-striped table-borderless">
            <thead>
            <th>No.</th>
            <th>Username</th>
            <th>Score</th>
            </thead>
            <tbody>
            <tr *ngFor="let item of ranking; index as i">
              <td>{{ i + 1 }}</td>
              <td>{{ item.username }}</td>
              <td>{{ item.score }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
